

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plugins &#8212; fuglu  documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Support" href="help-index.html" />
    <link rel="prev" title="Operation" href="operation-index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="help-index.html" title="Support"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="operation-index.html" title="Operation"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">fuglu  documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="plugins">
<h1>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The fuglu core does nothing except receiving mails from postfix and sending them back. All functionality
is written in plugins which can be enabled or disabled at will. Fuglu provides plugins for the most common
mail filtering requirements, but if some functionality is missing, it is easy to add new plugins without knowing
all of fuglu&#8217;s internals.</p>
</div>
<div class="section" id="types-of-plugins">
<h2>Types of plugins<a class="headerlink" href="#types-of-plugins" title="Permalink to this headline">¶</a></h2>
<div class="section" id="scanner-plugins">
<h3>Scanner Plugins<a class="headerlink" href="#scanner-plugins" title="Permalink to this headline">¶</a></h3>
<p>Scanner plugins are the most important type of plugins. They do the actual mail content filtering.
Plugins are run in the order specified in the <code class="docutils literal"><span class="pre">plugins=</span></code> configuration option. Each plugin returns an action
for the message:</p>
<blockquote>
<div><ul class="simple">
<li><strong>DUNNO</strong>  : This plugin decides not to take any final action, continue with the next plugin (this is the most common case)</li>
<li><strong>ACCEPT</strong> : Whitelist this message, don&#8217;t run any remaining plugins</li>
<li><strong>DELETE</strong> : Silently delete this message (The sender will think it has been delivered)</li>
<li><strong>DEFER</strong>  : Temporary Reject (4xx error), used for error conditions in after-queue mode or things like greylisting in before-queue mode</li>
<li><strong>REJECT</strong> : Reject this message, should only be used in before-queue mode (in after-queue mode this would produce a bounce / backscatter)</li>
</ul>
</div></blockquote>
<p>If one of the plugins returns something other than <em>DUNNO</em>, all remaining scanner plugins are skipped.
If all plugins return DUNNO, the message is accepted and re-injected to postfix.</p>
</div>
<div class="section" id="prepender-plugins">
<h3>Prepender Plugins<a class="headerlink" href="#prepender-plugins" title="Permalink to this headline">¶</a></h3>
<p>Prepender plugins run before the scanner plugins and have the ability to alter the
list of scanner plugins to be run. This can be used for example to have different plugins
run for incoming or outgoing mails or to skip whitelisted messages.</p>
</div>
<div class="section" id="appender-plugins">
<h3>Appender Plugins<a class="headerlink" href="#appender-plugins" title="Permalink to this headline">¶</a></h3>
<p>Appender plugins are run after the scanner plugins when the message has already been re-injected into postfix
(or rejected or deleted or...) so they don&#8217;t increase your scanning time . They are mostly used for statistical tasks, updating counters in a database etc.</p>
</div>
</div>
<div class="section" id="plugin-configuration">
<h2>Plugin configuration<a class="headerlink" href="#plugin-configuration" title="Permalink to this headline">¶</a></h2>
<p>Each plugin has its own configuration section in <code class="docutils literal"><span class="pre">/etc/fuglu/fuglu.conf</span></code> or any <code class="docutils literal"><span class="pre">*.conf</span></code> in <code class="docutils literal"><span class="pre">/etc/fuglu/conf.d</span></code>. The section is usually
named like the plugin itself.</p>
<p>For example, the Spamassassin Plugin&#8217;s Name is <code class="docutils literal"><span class="pre">SAplugin</span></code>, so it would search for a <code class="docutils literal"><span class="pre">[SAPlugin]</span></code> config section.</p>
<div class="section" id="suspect-filters">
<h3>Suspect Filters<a class="headerlink" href="#suspect-filters" title="Permalink to this headline">¶</a></h3>
<p>SuspectFilter are special rule files used by many fuglu plugins. Often they define actions a plugin should take based on a message header or suspect tag.</p>
<p>The format is : <code class="docutils literal"><span class="pre">&lt;property&gt;</span> <span class="pre">&lt;regex&gt;</span> <span class="pre">&lt;optional</span> <span class="pre">argument&gt;</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;property&gt;</span></code> can be any of...</dt>
<dd><ul class="first simple">
<li>a email header name, e.g. <code class="docutils literal"><span class="pre">Received</span></code>, <code class="docutils literal"><span class="pre">To</span></code>, <code class="docutils literal"><span class="pre">From</span></code>, <code class="docutils literal"><span class="pre">Subject</span></code> ... also supports &#8216;*&#8217; as wildcard character</li>
<li><code class="docutils literal"><span class="pre">mime:headername</span></code> to get mime Headers in the message payload  eg: <code class="docutils literal"><span class="pre">mime:Content-Disposition</span></code></li>
<li>one of fuglus builtin names to get envelope data:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">envelope_from</span></code> or <code class="docutils literal"><span class="pre">from_address</span></code>  (the envelope from address)</li>
<li><code class="docutils literal"><span class="pre">from_domain</span></code> (domain part of envelope_from)</li>
<li><code class="docutils literal"><span class="pre">envelope_to</span></code> or <code class="docutils literal"><span class="pre">to_address</span></code> (envelope to address)</li>
<li><code class="docutils literal"><span class="pre">to_domain</span></code> (domain part of envelope_to)</li>
</ul>
</div></blockquote>
<ul class="last simple">
<li>a <code class="docutils literal"><span class="pre">message</span> <span class="pre">Tag</span></code> prepended by the &#64; symbol, eg. <code class="docutils literal"><span class="pre">&#64;incomingport</span></code></li>
<li><code class="docutils literal"><span class="pre">body:raw</span></code> to match the the decoded message body (only applies to text/* parts)</li>
<li><code class="docutils literal"><span class="pre">body:stripped</span></code> or just <code class="docutils literal"><span class="pre">body</span></code> to match the the  message body (only applies to text/* parts), with stripped tags and newlines replaced with space (similar to SpamAssassin body rules)</li>
<li><code class="docutils literal"><span class="pre">body:full</span></code> to match the full body</li>
</ul>
</dd>
</dl>
<p><code class="docutils literal"><span class="pre">&lt;regex&gt;</span></code> is a standard python regular expression applied to <code class="docutils literal"><span class="pre">&lt;property&gt;</span></code>. if the regex is not enclosed by forward slashes, be sure not to include any whitespace in the regex, it must be one continous string. To match whitespace, use <code class="docutils literal"><span class="pre">\s</span></code>. all regexes that are not enclosed in forward slashes are automatically <code class="docutils literal"><span class="pre">case</span> <span class="pre">insensitive</span></code> and support multiple lines (re.DOTALL is enabled, so the newline character is matched by a dot). with slashes, the regex flags can be defined manually, eg.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Subject</span> <span class="o">/</span><span class="n">hello</span> <span class="n">world</span><span class="o">/</span><span class="n">i</span> <span class="n">match</span> <span class="n">hello</span> <span class="n">world</span><span class="p">,</span> <span class="n">case</span> <span class="n">insensitive</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;optional</span> <span class="pre">argument&gt;</span></code> depends on the plugin that reads this header filter file, some don&#8217;t need arguments at all. Please refer to the plugin documentation.</p>
<p>Filter files are automatically reloaded if you change anything, you don&#8217;t need to restart fuglu.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#normal header test
Subject hello   Hello in the subject!
MIME-Version ^1\.0$ Mime Version is 1.0

#builtin special fields
to_domain       (\.)?fuglu\.org$        Sent to fuglu.org or any subdomain
envelope_from ^sender@example\.com$

#match a tag from a previous plugin
@SAPlugin.report MISSING_HEADER

#wildcard
X-Spam-* .*     a X-Spam-&lt;something&gt; header exists

#decoded body text parts
body    Viagra

#full body
body:full ^--SPAMMY-MIME-BOUNDARY

#mime-headers
mime:Content-Type ^application\/x-msdos-program$
</pre></div>
</div>
<p>see <a class="reference internal" href="operation-index.html#debug-suspect-filter"><span class="std std-ref">Debug a suspect filter</span></a> for info on how to debug suspect filter files on specific messages.</p>
</div>
<div class="section" id="template-variables">
<h3>Template Variables<a class="headerlink" href="#template-variables" title="Permalink to this headline">¶</a></h3>
<p>Some plugins allow you to create templates (errormessages in bounces, reject reasons, ...). Here is a list of commonly used template variables that should be available in those templates. Plugins may not support all those variables and can add more variables not listed here. If unsure, check the plugin documentation.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">${from_address}</span></code> : Envelope Sender Address</li>
<li><code class="docutils literal"><span class="pre">${to_address}</span></code>   : Envelope Recipient Address</li>
<li><code class="docutils literal"><span class="pre">${from_domain}</span></code>  : Envelope Sender Domain</li>
<li><code class="docutils literal"><span class="pre">${to_domain}</span></code>    : Envelope Recipient Domain</li>
<li><code class="docutils literal"><span class="pre">${timestamp}</span></code>    : Unix Timestamp when the message was received</li>
<li><code class="docutils literal"><span class="pre">${subject}</span></code>      : Message subject</li>
<li><code class="docutils literal"><span class="pre">${date}</span></code>         : Current date</li>
<li><code class="docutils literal"><span class="pre">${time}</span></code>         : Current time</li>
<li><code class="docutils literal"><span class="pre">${blockinfo}</span></code>    : Reason why this message was blocked (available in the attachment plugin)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="plugins-included-in-fuglu">
<h2>Plugins included in Fuglu<a class="headerlink" href="#plugins-included-in-fuglu" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spamassassin">
<h3>SpamAssassin<a class="headerlink" href="#spamassassin" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.sa.SAPlugin</p>
<p>This plugin passes suspects to a spamassassin daemon.</p>
<p>Prerequisites: SPAMD must be installed and running (not necessarily on the same box as fuglu)</p>
<p>Notes for developers:</p>
<p>if forwardoriginal=False, the message source will be completely replaced with the answer from spamd.</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>reads <code class="docutils literal"><span class="pre">SAPlugin.skip</span></code>, (boolean) skips scanning if this is True</li>
<li>reads <code class="docutils literal"><span class="pre">SAPlugin.tempheader</span></code>, (text) prepends this text to the scanned message (use this to pass temporary headers to spamassassin which should not be visible in the final message)</li>
<li>sets <code class="docutils literal"><span class="pre">spam['spamassassin']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">SAPlugin.spamscore</span></code> (float) if possible</li>
<li>sets <code class="docutils literal"><span class="pre">SAPlugin.skipreason</span></code> (string) if the message was not scanned (fuglu &gt;0.5.0)</li>
</ul>
</div></blockquote>
<div class="section" id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[SAPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#reject message template if running in pre-queue mode
rejectmessage=message identified as spam

#forward the original message or replace the content as returned by spamassassin
#if this is set to True/1/Yes , no spamassassin headers will be visible in the final message.
#&quot;original&quot; in this case means &quot;as passed to spamassassin&quot;, eg. if &#39;scanoriginal&#39; is set to 0 above this will forward the
#message as retreived from previous plugins
forwardoriginal=0

#consult spamassassins(or any other) sql blacklist for messages that are too big for spam checks
#requires the sql extension to be enabled
check_sql_blacklist=0

#sqlalchemy db connect string
sql_blacklist_dbconnectstring=mysql:///localhost/spamassassin

#SQL query to get the blacklist entries for a suspect
#you may use template variables: ${from_address} ${from_domain} ${to_address} ${to_domain}
sql_blacklist_sql=SELECT value FROM userpref WHERE prefid=&#39;blacklist_from&#39; AND username in (&#39;$GLOBAL&#39;,concat(&#39;%&#39;,${to_domain}),${to_address})

#maximum size in bytes. larger messages will be skipped
maxsize=256000

#what header does SA set to indicate the spam status
#Note that fuglu requires a standard header template configuration for spamstatus and score extraction
#if &#39;forwardoriginal&#39; is set to 0
#eg. start with _YESNO_ or _YESNOCAPS_ and contain score=_SCORE_
spamheader=X-Spam-Status

#hostname where spamd runs
host=localhost

#what should we do with high spam (spam score above highspamlevel)
highspamaction=DEFAULTHIGHSPAMACTION

#how long should we wait for an answer from sa
timeout=30

#spamscore threshold to mark a message as high spam
highspamlevel=15

#enable SA user configuration
peruserconfig=1

#tcp port number or path to spamd unix socket
port=783

#should we scan the original message as retreived from postfix or scan the current state
#in fuglu (which might have been altered by previous plugins)
#only set this to disabled if you have a custom plugin that adds special headers to the message that will be
#used in spamassassin rules
scanoriginal=1

#what should we do with low spam (eg. detected as spam, but score not over highspamlevel)
lowspamaction=DEFAULTLOWSPAMACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="clam-av">
<h3>Clam AV<a class="headerlink" href="#clam-av" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.clamav.ClamavPlugin</p>
<p>This plugin passes suspects to a clam daemon.</p>
<p>Actions: This plugin will delete infected messages. If clamd is not reachable or times out, messages can be DEFERRED.</p>
<p>Prerequisites: You must have clamd installed (for performance reasons I recommend it to be on the same box, but this is not absoluely necessary)</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['ClamAV']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">ClamavPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id1">
<h4>Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[ClamavPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where clamd runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#socket timeout
timeout=30

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#*EXPERIMENTAL*: Perform multiple scans over the same connection. May improve performance on busy systems.
pipelining=0

#maximum message size, larger messages will not be scanned.
#should match the &#39;StreamMaxLength&#39; config option in clamd.conf
maxsize=22000000

#tcp port number or path to clamd.sock for unix domain sockets
#example /var/lib/clamav/clamd.sock or on ubuntu: /var/run/clamav/clamd.ctl
port=3310

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="attachment-blocker">
<h3>Attachment Blocker<a class="headerlink" href="#attachment-blocker" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.attachment.FiletypePlugin</p>
<p>This plugin checks message attachments. You can configure what filetypes or filenames are allowed to pass through fuglu. If a attachment is not allowed, the message is deleted and the sender receives a bounce error message. The plugin uses the &#8216;&#8217;&#8216;file&#8217;&#8216;&#8217; library to identify attachments, so even if a smart sender renames his executable to .txt, fuglu will detect it.</p>
<p>Attachment rules can be defined globally, per domain or per user.</p>
<p>Actions: This plugin will delete messages if they contain blocked attachments.</p>
<p>Prerequisites: You must have the python <code class="docutils literal"><span class="pre">file</span></code> or <code class="docutils literal"><span class="pre">magic</span></code> module installed. Additionaly, for scanning filenames within rar archives, fuglu needs the python <code class="docutils literal"><span class="pre">rarfile</span></code> module.</p>
<p>The attachment configuration files are in <code class="docutils literal"><span class="pre">/etc/fuglu/rules</span></code>. You should have two default files there: <code class="docutils literal"><span class="pre">default-filenames.conf</span></code> which defines what filenames are allowed and <code class="docutils literal"><span class="pre">default-filetypes.conf</span></code> which defines what content types a attachment may have.</p>
<p>For domain rules, create a new file <code class="docutils literal"><span class="pre">&lt;domainname&gt;-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">&lt;domainname&gt;-filetypes.conf</span></code> , eg. <code class="docutils literal"><span class="pre">fuglu.org-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">fuglu.org-filetypes.conf</span></code></p>
<p>For individual user rules, create a new file <code class="docutils literal"><span class="pre">&lt;useremail&gt;-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">&lt;useremail&gt;-filetypes.conf</span></code>, eg. <code class="docutils literal"><span class="pre">oli&#64;fuglu.org-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">oli&#64;fuglu.org-filetypes.conf</span></code></p>
<p>To scan filenames or even file contents within archives (zip, rar), use <code class="docutils literal"><span class="pre">&lt;...&gt;-archivefilenames.conf</span></code> and <code class="docutils literal"><span class="pre">&lt;...&gt;-archivefiletypes.conf</span></code>.</p>
<p>The format of those files is as follows: Each line should have three parts, seperated by tabs (or any whitespace):
<code class="docutils literal"><span class="pre">&lt;action&gt;</span></code>    <code class="docutils literal"><span class="pre">&lt;regular</span> <span class="pre">expression&gt;</span></code>   <code class="docutils literal"><span class="pre">&lt;description</span> <span class="pre">or</span> <span class="pre">error</span> <span class="pre">message&gt;</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;action&gt;</span></code> can be one of:</dt>
<dd><ul class="first last simple">
<li>allow : this file is ok, don&#8217;t do further checks (you might use it for safe content types like text). Do not blindly create &#8216;allow&#8217; rules. It&#8217;s safer to make no rule at all, if no other rules hit, the file will be accepted</li>
<li>deny : delete this message and send the error message/description back to the sender</li>
<li>delete : silently delete the message, no error is sent back, and &#8216;blockaction&#8217; is ignored</li>
</ul>
</dd>
</dl>
<p><code class="docutils literal"><span class="pre">&lt;regular</span> <span class="pre">expression&gt;</span></code> is a standard python regex. in <code class="docutils literal"><span class="pre">x-filenames.conf</span></code> this will be applied to the attachment name . in <code class="docutils literal"><span class="pre">x-filetypes.conf</span></code> this will be applied to the mime type of the file as well as the file type returned by the <code class="docutils literal"><span class="pre">file</span></code> command.</p>
<p>Example of <code class="docutils literal"><span class="pre">default-filetypes.conf</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>allow    text        -
allow    script    -
allow    archive        -
allow    postscript    -
deny    self-extract    No self-extracting archives
deny    executable    No programs allowed
deny    ELF        No programs allowed
deny    Registry    No Windows Registry files allowed
</pre></div>
</div>
<p>A small extract from <code class="docutils literal"><span class="pre">default-filenames.conf</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>deny    \.ico$            Windows icon file security vulnerability
deny    \.ani$            Windows animated cursor file security vulnerability
deny    \.cur$            Windows cursor file security vulnerability
deny    \.hlp$            Windows help file security vulnerability

allow    \.jpg$            -
allow    \.gif$            -
</pre></div>
</div>
<p>Note: The files will be reloaded automatically after a few seconds (you do not need to kill -HUP / restart fuglu)</p>
<p>Per domain/user overrides can also be fetched from a database instead of files (see dbconnectstring / query options).
The query must return the same rule format as a file would. Multiple columns in the resultset will be concatenated.</p>
<p>The default query assumes the following schema:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CREATE TABLE `attachmentrules` (
  `rule_id` int(11) NOT NULL AUTO_INCREMENT,
  `action` varchar(10) NOT NULL,
  `regex` varchar(255) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `scope` varchar(255) DEFAULT NULL,
  `checktype` varchar(20) NOT NULL,
  `prio` int(11) NOT NULL,
  PRIMARY KEY (`rule_id`)
)
</pre></div>
</div>
<p><em>action</em>: <code class="docutils literal"><span class="pre">allow</span></code>, <code class="docutils literal"><span class="pre">deny</span></code>, or <code class="docutils literal"><span class="pre">delete</span></code></p>
<p><em>regex</em>: a regular expression</p>
<p><em>description</em>: description/explanation of this rule which is optionally sent back to the sender if bounces are enabled</p>
<p><em>scope</em>: a domain name or a recipient&#8217;s email address</p>
<p><em>checktype</em>: one of <code class="docutils literal"><span class="pre">filename</span></code>,``contenttype``,``archive-filename``,``archive-contenttype``</p>
<p><em>prio</em>: order in which the rules are run</p>
<p>The bounce template (eg <code class="docutils literal"><span class="pre">/etc/fuglu/templates/blockedfile.tmpl</span></code> ) should
start by defining the headers, followed by a blank line, then the message body for your bounce message. Something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>To: ${from_address}
Subject: Blocked attachment

Your message to ${to_address} contains a blocked attachment and has not been delivered.

${blockinfo}
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">${blockinfo}</span></code> will be replaced with the text you specified in the third column of the rule that blocked this message.</p>
<p>The other common template variables are available as well.</p>
<div class="section" id="id2">
<h4>Configuration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FiletypePlugin</span><span class="p">]</span>
<span class="c1">#inform the sender about blocked attachments.</span>
<span class="c1">#If a previous plugin tagged the message as spam or infected, no bounce will be sent to prevent backscatter</span>
<span class="n">sendbounce</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#sqlalchemy connectstring to load rules from a database and use files only as fallback. requires SQL extension to be enabled</span>
<span class="n">dbconnectstring</span><span class="o">=</span>

<span class="c1">#sql query to load rules from a db. #:scope will be replaced by the recipient address first, then by the recipient domain</span>
<span class="c1">#:check will be replaced &#39;filename&#39;,&#39;contenttype&#39;,&#39;archive-filename&#39; or &#39;archive-contenttype&#39;</span>
<span class="n">query</span><span class="o">=</span><span class="n">SELECT</span> <span class="n">action</span><span class="p">,</span><span class="n">regex</span><span class="p">,</span><span class="n">description</span> <span class="n">FROM</span> <span class="n">attachmentrules</span> <span class="n">WHERE</span> <span class="n">scope</span><span class="o">=</span><span class="p">:</span><span class="n">scope</span> <span class="n">AND</span> <span class="n">checktype</span><span class="o">=</span><span class="p">:</span><span class="n">checktype</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">prio</span>

<span class="c1">#Mail template for the bounce to inform sender about blocked attachment</span>
<span class="n">template_blockedfile</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">blockedfile</span><span class="o">.</span><span class="n">tmpl</span>

<span class="c1">#directory that contains attachment rules</span>
<span class="n">rulesdir</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">rules</span>

<span class="c1">#enable scanning of filenames within archives (zip,rar). This does not actually extract the files, it just looks at the filenames found in the archive.</span>
<span class="n">checkarchivenames</span><span class="o">=</span><span class="mi">0</span>

<span class="c1">#what should the plugin do when a blocked attachment is detected</span>
<span class="c1">#REJECT : reject the message (recommended in pre-queue mode)</span>
<span class="c1">#DELETE : discard messages</span>
<span class="c1">#DUNNO  : mark as blocked but continue anyway (eg. if you have a later quarantine plugin)</span>
<span class="n">blockaction</span><span class="o">=</span><span class="n">DELETE</span>

<span class="c1">#extract compressed archives(zip,rar) and check file content type with libmagics</span>
<span class="c1">#note that the files will be extracted into memory - tune archivecontentmaxsize  accordingly.</span>
<span class="c1">#fuglu does not extract archives within the archive(recursion)</span>
<span class="n">checkarchivecontent</span><span class="o">=</span><span class="mi">0</span>

<span class="c1">#only extract and examine files up to this amount of (uncompressed) bytes</span>
<span class="n">archivecontentmaxsize</span><span class="o">=</span><span class="mi">5000000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="archive">
<h3>Archive<a class="headerlink" href="#archive" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.archive.ArchivePlugin</p>
<p>This plugins stores a copy of the message if it matches certain criteria (Suspect Filter).
You can use this if you want message archives for your domains or to debug problems occuring only for certain recipients.</p>
<p>Examples for the archive.regex filter file:</p>
<p>Archive messages to domain &#8216;&#8217;test.com&#8217;&#8216;:</p>
<p><code class="docutils literal"><span class="pre">to_domain</span> <span class="pre">test\.com</span></code></p>
<p>Archive messages from <a class="reference external" href="mailto:oli&#37;&#52;&#48;fuglu&#46;org">oli<span>&#64;</span>fuglu<span>&#46;</span>org</a>:</p>
<p><code class="docutils literal"><span class="pre">envelope_from</span> <span class="pre">oli&#64;fuglu\.org</span></code></p>
<p>you can also append &#8220;yes&#8221; and &#8220;no&#8221; to the rules to create a more advanced configuration. Lets say we want to archive all messages to <a class="reference external" href="mailto:sales&#37;&#52;&#48;fuglu&#46;org">sales<span>&#64;</span>fuglu<span>&#46;</span>org</a> and all regular messages <a class="reference external" href="mailto:support&#37;&#52;&#48;fuglu&#46;org">support<span>&#64;</span>fuglu<span>&#46;</span>org</a> except the ones created by automated scripts like logwatch or daily backup messages etc.</p>
<p>envelope_from logwatch&#64;.*fuglu.org   no</p>
<p>envelope_to <a class="reference external" href="mailto:sales&#37;&#52;&#48;fuglu&#46;org">sales<span>&#64;</span>fuglu<span>&#46;</span>org</a> yes</p>
<p>from <a class="reference external" href="mailto:backups&#37;&#52;&#48;fuglu&#46;org">backups<span>&#64;</span>fuglu<span>&#46;</span>org</a> no</p>
<p>envelope_to <a class="reference external" href="mailto:support&#37;&#52;&#48;fuglu&#46;org">support<span>&#64;</span>fuglu<span>&#46;</span>org</a>      yes</p>
<p>Note: The first rule to match in a message is the only rule that will be applied. Exclusion rules should therefore be put above generic/catch-all rules.</p>
<div class="section" id="id3">
<h4>Configuration<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[ArchivePlugin]
#change owner of saved messages (username or numeric id) - this only works if fuglu is running as root (which is NOT recommended)
chown=

#Archiving SuspectFilter File
archiverules=/etc/fuglu/archive.regex

#filename template for the archived messages
filenametemplate=${id}.eml

#subdirectory within archivedir
subdirtemplate=${to_domain}

#if true/1/yes: store original message
#if false/0/no: store message probably altered by previous plugins, eg with spamassassin headers
storeoriginal=1

#storage for archived messages
archivedir=/tmp

#set file permissions of saved messages
chmod=

#change group of saved messages (groupname or numeric id) - the user running fuglu must be a member of the target group for this to work
chgrp=
</pre></div>
</div>
</div>
</div>
<div class="section" id="vacation">
<h3>Vacation<a class="headerlink" href="#vacation" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.vacation.VacationPlugin</p>
<p>Sends out-of-office reply messages. Configuration is trough a sql database. Replies are only sent once per day per sender. The plugin will not reply to any &#8216;automated&#8217; messages (Mailingslists, Spams, Bounces etc)</p>
<p>Requires: SQLAlechemy Extension</p>
<dl class="docutils">
<dt>Required DB Tables:</dt>
<dd><ul class="first last simple">
<li>vacation (fuglu reads this table only, must be filled from elsewhere)<ul>
<li>id int : id of this vacation</li>
<li>created timestamp :  creation timestamp</li>
<li>enabled boolean (eg. tinyint) : if disabled, no vacation reply will be sent</li>
<li>start timestamp: replies will only be sent after this point in time</li>
<li>end timestamp: replies will only be sent before this point in time</li>
<li>awayuser varchar: the email address of the user that is on vacation</li>
<li>subject: subject of the vacation message</li>
<li>body : body of the vacation message</li>
<li>ignoresender: whitespace delimited list of domains or email addresses that should not receive vacation replies</li>
</ul>
</li>
<li>vacationreply (this table is filled by fuglu)<ul>
<li>id int: id of the reply</li>
<li>vacation_id : id of the vacation</li>
<li>sent timestamp: timestamp when the reply was sent</li>
<li>recipient: recipient to whom the reply was sent</li>
</ul>
</li>
</ul>
</dd>
</dl>
<p>SQL Example for mysql:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CREATE TABLE `vacation` (
  `id` int(11) NOT NULL auto_increment,
  `created` timestamp NOT NULL default now(),
  `start` timestamp NOT NULL,
  `end` timestamp NOT NULL ,
  `enabled` tinyint(1) NOT NULL default 1,
  `awayuser` varchar(255) NOT NULL,
  `subject` varchar(255) NOT NULL,
  `body` text NOT NULL,
  `ignoresender` text NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE(`awayuser`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ;


CREATE  TABLE `vacationreply` (
  `id` int(11) NOT NULL auto_increment,
  `recipient` varchar(255) NOT NULL,
  `vacation_id` int(11) NOT NULL,
     `sent` timestamp not null default now(),
  PRIMARY KEY  (`id`),
  KEY `vacation_id` (`vacation_id`),
  CONSTRAINT `vacation_ibfk_1` FOREIGN KEY (`vacation_id`) REFERENCES `vacation` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</pre></div>
</div>
<div class="section" id="id4">
<h4>Configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">VacationPlugin</span><span class="p">]</span>
<span class="c1">#sqlalchemy connectstring to load vacations</span>
<span class="n">dbconnectstring</span><span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sophos">
<h3>Sophos<a class="headerlink" href="#sophos" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.sssp.SSSPPlugin</p>
<blockquote>
<div>This plugin scans the suspect using the sophos SSSP protocol.</div></blockquote>
<p>Prerequisites: Requires a running sophos daemon with dynamic interface (SAVDI)</p>
<div class="section" id="id5">
<h4>Configuration<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[SSSPPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where the SSSP server runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#socket timeout
timeout=30

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#maximum message size, larger messages will not be scanned.
maxsize=22000000

#tcp port or path to unix socket
port=4010

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="f-prot-av">
<h3>F-Prot AV<a class="headerlink" href="#f-prot-av" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.fprot.FprotPlugin</p>
<blockquote>
<div>This plugin passes suspects to a f-prot scan daemon</div></blockquote>
<p>Prerequisites: f-protd must be installed and running, not necessarily on the same box as fuglu though.</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['F-Prot']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">FprotPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id6">
<h4>Configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[FprotPlugin]
#additional scan options  (see `man fpscand` -&gt; SCANNING OPTIONS for possible values)
scanoptions=

#maximum retries on failed connections
retries=3

#hostname where fpscand runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#if fpscand runs on a different host than fuglu, set this to 1 to send the message over the network instead of just the filename
networkmode=0

#network timeout
timeout=30

#plugin action if scan fails
problemaction=DEFER

#maximum message size to scan
maxsize=10485000

#fpscand port
port=10200

#plugin action if threat is detected
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="icap-av">
<h3>ICAP AV<a class="headerlink" href="#icap-av" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.icap.ICAPPlugin</p>
<p>ICAP Antivirus Plugin
This plugin allows Antivirus Scanning over the ICAP Protocol (<a class="reference external" href="http://tools.ietf.org/html/rfc3507">http://tools.ietf.org/html/rfc3507</a> )
supported by some AV Scanners like Symantec and Sophos. For sophos, however, it is recommended to use the native SSSP Protocol.</p>
<p>Prerequisites: requires an ICAP capable antivirus engine somewhere in your network</p>
<div class="section" id="id7">
<h4>Configuration<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[ICAPPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where the ICAP server runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#ICAP Av scan service, usually AVSCAN (sophos, symantec)
service=AVSCAN

#socket timeout
timeout=10

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#name of the virus engine behind the icap service. used to inform other plugins. can be anything like &#39;sophos&#39;, &#39;symantec&#39;, ...
enginename=icap-generic

#maximum message size, larger messages will not be scanned.
maxsize=22000000

#tcp port or path to unix socket
port=1344

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="drweb-av">
<h3>DrWeb AV<a class="headerlink" href="#drweb-av" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.drweb.DrWebPlugin</p>
<blockquote>
<div>This plugin passes suspects to a DrWeb scan daemon</div></blockquote>
<p>EXPERIMENTAL Plugin: has not been tested in production.</p>
<p>Prerequisites: Dr.Web unix version must be installed and running, not necessarily on the same box as fuglu though.</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['drweb']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">DrWebPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id8">
<h4>Configuration<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[DrWebPlugin]
#maximum retries on failed connections
retries=3

#hostname where fpscand runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#network timeout
timeout=30

#plugin action if scan fails
problemaction=DEFER

#maximum message size to scan
maxsize=22000000

#DrWeb daemon port
port=3000

#plugin action if threat is detected
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="action-override">
<h3>Action Override<a class="headerlink" href="#action-override" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.actionoverride.ActionOverridePlugin</p>
<blockquote>
<div>Override actions based on a Suspect Filter file. For example, delete all messages from a specific sender domain.</div></blockquote>
<div class="section" id="id9">
<h4>Configuration<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ActionOverridePlugin</span><span class="p">]</span>
<span class="c1">#Rules file</span>
<span class="n">actionrules</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">actionrules</span><span class="o">.</span><span class="n">regex</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scriptfilter">
<h3>ScriptFilter<a class="headerlink" href="#scriptfilter" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.script.ScriptFilter</p>
<p>This plugin executes scripts found in a specified directory.
This can be used to quickly add a custom filter script without changing the fuglu configuration.</p>
<p>Filterscripts must be written in standard python but with the file ending <code class="docutils literal"><span class="pre">.fgf</span></code> (&#8220;fuglu filter&#8221;)</p>
<p>Scripts are reloaded for every message and executed in alphabetic order. You do not need to restart fuglu to load any changes made to these files.</p>
<p>The API is basically the same as for normal plugins within the <code class="docutils literal"><span class="pre">examine()</span></code> method, with a few special cases:</p>
<p>there is no &#8216;self&#8217; which means:</p>
<blockquote>
<div><ul class="simple">
<li>access the configuration by using <code class="docutils literal"><span class="pre">config</span></code> directly (instead of <code class="docutils literal"><span class="pre">self.config</span></code>)</li>
<li>use <code class="docutils literal"><span class="pre">debug('hello</span> <span class="pre">world')</span></code> instead of <code class="docutils literal"><span class="pre">self._logger().debug('hello</span> <span class="pre">world')</span></code>, this will also automatically write to the message debug channel</li>
</ul>
</div></blockquote>
<p>the script should not return anything, but change the available variables <code class="docutils literal"><span class="pre">action</span></code> and <code class="docutils literal"><span class="pre">message</span></code> instead
(<code class="docutils literal"><span class="pre">DUNNO</span></code>, <code class="docutils literal"><span class="pre">REJECT</span></code>, <code class="docutils literal"><span class="pre">DEFER</span></code>, <code class="docutils literal"><span class="pre">ACCEPT</span></code>, <code class="docutils literal"><span class="pre">DELETE</span></code> are already imported)</p>
<p>use <code class="docutils literal"><span class="pre">stop(action=DUNNO,</span> <span class="pre">message='')</span></code> to exit the script early</p>
<p>Example script:
(put this in /etc/fuglu/scriptfilter/99_demo.fgf for example)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#block all messages from evilsender.example.com</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">suspect</span><span class="o">.</span><span class="n">from_domain</span><span class="o">==</span><span class="s1">&#39;evilsender.example.com&#39;</span><span class="p">:</span>
    <span class="n">suspect</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;x-fuglu-SenderDomain&quot;</span><span class="p">,</span><span class="n">suspect</span><span class="o">.</span><span class="n">from_domain</span><span class="p">,</span><span class="n">immediate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stop</span><span class="p">()</span>
<span class="n">debug</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="n">action</span><span class="o">=</span><span class="n">REJECT</span>
<span class="n">message</span><span class="o">=</span><span class="s2">&quot;you shall not pass&quot;</span>
</pre></div>
</div>
<div class="section" id="id10">
<h4>Configuration<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ScriptFilter</span><span class="p">]</span>
<span class="c1">#Dir that contains the scripts (*.fgf files)</span>
<span class="n">scriptdir</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">scriptfilter</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dkim-sign">
<h3>DKIM Sign<a class="headerlink" href="#dkim-sign" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.domainauth.DKIMSignPlugin</p>
<p><strong>EXPERIMENTAL</strong>
Add DKIM Signature to outgoing mails</p>
<p>Setting up your keys:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir -p /etc/fuglu/dkim
domain=example.com
openssl genrsa -out /etc/fuglu/dkim/${domain}.key 1024
openssl rsa -in /etc/fuglu/dkim/${domain}.key -out /etc/fuglu/dkim/${domain}.pub -pubout -outform PEM
# print out the DNS record:
echo -n &quot;default._domainkey TXT  \&quot;v=DKIM1; k=rsa; p=&quot; ; cat /etc/fuglu/dkim/${domain}.pub | grep -v &#39;PUBLIC KEY&#39; | tr -d &#39;\n&#39; ; echo &quot;;\&quot;&quot;
</pre></div>
</div>
<p>If fuglu handles both incoming and outgoing mails you should make sure that this plugin is skipped for incoming mails</p>
<p>known issues:</p>
<blockquote>
<div><ul class="simple">
<li>setting canonicalizeheaders = simple will cause invalid signature.</li>
<li>signbodylength causes a crash in dkimlib &#8220;TypeError: sequence item 1: expected string, int found&#8221;</li>
</ul>
</div></blockquote>
<div class="section" id="id11">
<h4>Configuration<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[DKIMSignPlugin]
#comma separated list of headers to sign. empty string=sign all headers
signheaders=From,Reply-To,Subject,Date,To,CC,Resent-Date,Resent-From,Resent-To,Resent-CC,In-Reply-To,References,List-Id,List-Help,List-Unsubscribe,List-Subscribe,List-Post,List-Owner,List-Archive

#include l= tag in dkim header
signbodylength=False

#selector to use when signing, supports templates
selector=default

#Location of the private key file. supports standard template variables plus additional ${header_from_domain} which extracts the domain name from the From: -Header
privatekeyfile=/etc/fuglu/dkim/${header_from_domain}.key

#Type of body canonicalization (simple or relaxed)
canonicalizebody=relaxed

#Type of header canonicalization (simple or relaxed)
canonicalizeheaders=relaxed
</pre></div>
</div>
</div>
</div>
<div class="section" id="dkim-verify">
<h3>DKIM Verify<a class="headerlink" href="#dkim-verify" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.domainauth.DKIMVerifyPlugin</p>
<p><strong>EXPERIMENTAL</strong>
This plugin checks the DKIM signature of the message and sets tags...
DKIMVerify.sigvalid : True if there was a valid DKIM signature, False if there was an invalid DKIM signature
the tag is not set if there was no dkim header at all</p>
<p>DKIMVerify.skipreason: set if the verification has been skipped</p>
<p>The plugin does not take any action based on the DKIM test result since a failed DKIM validation by itself
should not cause a message to be treated any differently. Other plugins might use the DKIM result
in combination with other factors to take action (for example a &#8220;DMARC&#8221; plugin could use this information)</p>
<p>It is currently recommended to leave both header and body canonicalization as &#8216;relaxed&#8217;. Using &#8216;simple&#8217; can cause the signature to fail.</p>
<div class="section" id="id12">
<h4>Configuration<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DKIMVerifyPlugin</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="spf-check">
<h3>SPF Check<a class="headerlink" href="#spf-check" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.domainauth.SPFPlugin</p>
<p><strong>EXPERIMENTAL</strong>
This plugin checks the SPF status and sets tag &#8216;SPF.status&#8217; to one of the official states &#8216;pass&#8217;, &#8216;fail&#8217;, &#8216;neutral&#8217;,
&#8216;softfail, &#8216;permerror&#8217;, &#8216;temperror&#8217; or &#8216;skipped&#8217; if the SPF check could not be peformed.
Tag &#8216;SPF.explanation&#8217; contains a human readable explanation of the result</p>
<p>The plugin does not take any action based on the SPF test result since. Other plugins might use the SPF result
in combination with other factors to take action (for example a &#8220;DMARC&#8221; plugin could use this information)</p>
<div class="section" id="id13">
<h4>Configuration<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SPFPlugin</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="domainauth">
<h3>DomainAuth<a class="headerlink" href="#domainauth" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.domainauth.DomainAuthPlugin</p>
<p><strong>EXPERIMENTAL</strong>
This plugin checks the header from domain against a list of domains which must be authenticated by DKIM and/or SPF.
This is somewhat similar to DMARC but instead of asking the sender domain for a DMARC policy record this plugin allows you to force authentication on the recipient side.</p>
<p>This plugin depends on tags written by SPFPlugin and DKIMVerifyPlugin, so they must run beforehand.</p>
<div class="section" id="id14">
<h4>Configuration<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>[DomainAuthPlugin]
#action if the message doesn&#39;t pass authentication (DUNNO, REJECT)
failaction=DUNNO

#File containing a list of domains (one per line) which must be DKIM and/or SPF authenticated
domainsfile=/etc/fuglu/auth_required_domains.txt

#reject message template if running in pre-queue mode
rejectmessage=sender domain ${header_from_domain} must pass DKIM and/or SPF authentication
</pre></div>
</div>
</div>
</div>
<div class="section" id="plugin-skipper">
<h3>Plugin Skipper<a class="headerlink" href="#plugin-skipper" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.p_skipper.PluginSkipper</p>
<p>Skips plugins based on standard filter file
This can be used for example to skip spam filters on outgoing messages.
e.g. put this in /etc/fuglu/skipplugins.regex:</p>
<p>&#64;incomingport    1099    SAPlugin</p>
<div class="section" id="id15">
<h4>Configuration<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PluginSkipper</span><span class="p">]</span>
<span class="n">filterfile</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">skipplugins</span><span class="o">.</span><span class="n">regex</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plugin-fraction">
<h3>Plugin Fraction<a class="headerlink" href="#plugin-fraction" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.p_fraction.PluginFraction</p>
<p>Runs only a fraction of loaded scanner plugins based on standard filter file
Use this if you only want to run a fraction of the standard plugins on a specific port for example
eg. put this in /etc/fuglu/pluginfraction.regex:</p>
<p>&#64;incomingport    1100    SAPlugin,AttachmentPlugin</p>
<div class="section" id="id16">
<h4>Configuration<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PluginFraction</span><span class="p">]</span>
<span class="n">filterfile</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">fuglu</span><span class="o">/</span><span class="n">pluginfraction</span><span class="o">.</span><span class="n">regex</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugger">
<h3>Debugger<a class="headerlink" href="#debugger" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.p_debug.MessageDebugger</p>
<p>Message Debugger Plugin (Prepender).</p>
<p>This plugin enables the fuglu_debug functionality. Make sure fuglu listens on the debug port configured here.</p>
<div class="section" id="id17">
<h4>Configuration<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MessageDebugger</span><span class="p">]</span>
<span class="c1">#messages incoming on this port will be debugged to a logfile</span>
<span class="c1">#Make sure the debugport is also set in the incomingport configuration option in the main section</span>
<span class="n">debugport</span><span class="o">=</span><span class="mi">10888</span>

<span class="c1">#debug log output</span>
<span class="n">debugfile</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">fuglu_debug</span><span class="o">.</span><span class="n">log</span>

<span class="c1">#don&#39;t re-inject debugged messages back to postfix</span>
<span class="n">noreinject</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#debugged message can not be bounced</span>
<span class="n">nobounce</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#don&#39;t run appender plugins for debugged messages</span>
<span class="n">noappender</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-plugin-time">
<h3>Statsd Sender: Plugin Time<a class="headerlink" href="#statsd-sender-plugin-time" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.a_statsd.PluginTime</p>
<p>EXPERIMENTAL: Send Plugin execution time to a statsd server</p>
<div class="section" id="id18">
<h4>Configuration<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PluginTime</span><span class="p">]</span>
<span class="c1">#statsd host</span>
<span class="n">host</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>

<span class="c1">#statsd port</span>
<span class="n">port</span><span class="o">=</span><span class="mi">8125</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-global-message-status">
<h3>Statsd Sender: Global Message Status<a class="headerlink" href="#statsd-sender-global-message-status" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.a_statsd.MessageStatus</p>
<p>EXPERIMENTAL: Send message status to a statsd server</p>
<div class="section" id="id19">
<h4>Configuration<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MessageStatus</span><span class="p">]</span>
<span class="c1">#statsd host</span>
<span class="n">host</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>

<span class="c1">#statsd port</span>
<span class="n">port</span><span class="o">=</span><span class="mi">8125</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-per-recipient-message-status">
<h3>Statsd Sender: Per Recipient Message Status<a class="headerlink" href="#statsd-sender-per-recipient-message-status" title="Permalink to this headline">¶</a></h3>
<p>Plugin: fuglu.plugins.a_statsd.MessageStatusPerRecipient</p>
<p>EXPERIMENTAL: Send per recipient stats to a statsd server</p>
<div class="section" id="id20">
<h4>Configuration<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MessageStatusPerRecipient</span><span class="p">]</span>
<span class="c1">#statsd host</span>
<span class="n">host</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>

<span class="c1">#statsd port</span>
<span class="n">port</span><span class="o">=</span><span class="mi">8125</span>

<span class="c1">#domain: send stats per recipient domain. email: send stats per recipient email address</span>
<span class="n">level</span><span class="o">=</span><span class="n">domain</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="writing-your-own-plugins">
<h2>Writing your own plugins<a class="headerlink" href="#writing-your-own-plugins" title="Permalink to this headline">¶</a></h2>
<p>Assuming you know python basics, writing plugins for fuglu is very easy. All you have to do is create a new class which extends from <code class="docutils literal"><span class="pre">ScannerPlugin</span></code>, override <code class="docutils literal"><span class="pre">__str__</span></code> to provide a nice human readable name and override <code class="docutils literal"><span class="pre">examine</span></code> to do the actual work of your plugins. <code class="docutils literal"><span class="pre">examine</span></code> should return one of the action codes above (DUNNO, DEFER, DELETE, ....) and optionally a reason for the action. (e.g. <code class="docutils literal"><span class="pre">return</span> <span class="pre">DEFER,</span> <span class="pre">'please</span> <span class="pre">try</span> <span class="pre">again</span> <span class="pre">later'</span></code>
In plugin you usually only have to import things from <a class="reference internal" href="api.html#api-shared"><span class="std std-ref">fuglu.shared</span></a> , so it&#8217;s probably a good idea to get familiar with  that module.</p>
<p>This is a quick example of how your plugin code skeleton would look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fuglu.shared</span> <span class="k">import</span> <span class="n">ScannerPlugin</span><span class="p">,</span><span class="n">DUNNO</span>

<span class="k">class</span> <span class="nc">DemoPlugin</span><span class="p">(</span><span class="n">ScannerPlugin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy this to make a new plugin&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ScannerPlugin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="p">)</span>
        <span class="c1">#config example</span>
        <span class="c1">#self.requiredvars={</span>
        <span class="c1">#    &#39;maxsize&#39;:{</span>
        <span class="c1">#        &#39;default&#39;:&#39;1337&#39;,</span>
        <span class="c1">#        &#39;description&#39;:&#39;Maximum message size&#39;,</span>
        <span class="c1">#    }</span>
        <span class="c1">#}</span>

    <span class="k">def</span> <span class="nf">examine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">suspect</span><span class="p">):</span>
        <span class="c1">#config Example</span>
        <span class="c1">#maxsize=self.config.getint(self.section, &#39;maxsize&#39;)</span>

        <span class="c1">#debug example</span>
        <span class="c1">#self._logger().debug(&#39;hello world from DemoPlugin&#39;)</span>

        <span class="c1">#PUT PLUGIN CODE HERE</span>

        <span class="k">return</span> <span class="n">DUNNO</span>
</pre></div>
</div>
<p>First of all, you need a few imports. ScannerPlugin (so you can extend from it), and possible return values for your Plugin, <code class="docutils literal"><span class="pre">DUNNO</span></code> might be enough depending on what your plugin does.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fuglu.shared</span> <span class="k">import</span> <span class="n">ScannerPlugin</span><span class="p">,</span><span class="n">DUNNO</span>
</pre></div>
</div>
<p>in <code class="docutils literal"><span class="pre">__init__</span></code> you only call BasicPlugin&#8217;s <code class="docutils literal"><span class="pre">__init__</span></code>  for now. This sets <code class="docutils literal"><span class="pre">self.config</span></code> and <code class="docutils literal"><span class="pre">self.section</span></code> on the object where you later can read config options (eg. <code class="docutils literal"><span class="pre">self.config.get(self.section,'somevalue')</span></code>.  Do <strong>NOT</strong> load the plugin configuration here. <code class="docutils literal"><span class="pre">__init__</span></code> is only called once when fuglu starts up. Always load plugin config in <code class="docutils literal"><span class="pre">examine</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ScannerPlugin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="p">)</span>
</pre></div>
</div>
<p>then code your <code class="docutils literal"><span class="pre">examine</span></code> method. You will have to work with <a class="reference internal" href="api.html#api-suspect"><span class="std std-ref">The Suspect class</span></a>, which is a representation of the message being analyzed. The suspect has <code class="docutils literal"><span class="pre">tags</span></code> that are read and written by plugins.
You can tag a message as virus, as spam, define your own tags, read tags from previous plugins... it&#8217;s probably a good idea to look at the Suspect class in <code class="docutils literal"><span class="pre">fuglu.shared</span></code> to get a list of things you can do with the suspect.</p>
<div class="section" id="common-tasks-api-faq">
<h3>Common Tasks (&#8220;API&#8221; FAQ)<a class="headerlink" href="#common-tasks-api-faq" title="Permalink to this headline">¶</a></h3>
<div class="section" id="define-configuration-options-for-your-plugin">
<h4>Define configuration options for your plugin<a class="headerlink" href="#define-configuration-options-for-your-plugin" title="Permalink to this headline">¶</a></h4>
<p>In order to make &#8216;lint&#8217; and &#8216;fuglu_conf&#8217; work with your plugin it should tell the core what config options it expects. this is done by creating a dictionary named &#8216;requiredvars&#8217; in the plugins init:</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>def __init__(self,config,section=None):
        ScannerPlugin.__init__(self,config,section)
        self.requiredvars={
            &#39;host&#39;:{
                &#39;default&#39;:&#39;localhost&#39;,
                &#39;description&#39;:&#39;hostname&#39;,
            },

            &#39;username&#39;:{
                &#39;default&#39;:&#39;root&#39;,
            },

            &#39;password&#39;:{
                &#39;default&#39;:``,
                &#39;confidential&#39;:True,
            },

       }
</pre></div>
</div>
<p>This would tell fuglu that your plugin has three config options: host, username and password.</p>
<p>The &#8216;dict of dicts&#8217; uses your config option name as key for the outer dict. The inner dict supports the following keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">default</span></code> - default value, used if the option is not specified in the config file</li>
<li><code class="docutils literal"><span class="pre">section</span></code> - config section to check. by default fuglu assumes that the plugin reads its own config section. override this if your plugin requires a config option from a different plugin or from the main config</li>
<li><code class="docutils literal"><span class="pre">confidential</span></code> - set this to True if fuglu_conf should treat this option confidential and redact it in &#8216;fuglu_conf -n&#8217; (passwords etc)</li>
<li><code class="docutils literal"><span class="pre">validator</span></code> - function that should be called to validate if the configured value is valid. the function will receive the value as argument and must return True or False</li>
<li><code class="docutils literal"><span class="pre">deprecated</span></code> - mark a config option as deprecated</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="read-the-config">
<h4>Read the config<a class="headerlink" href="#read-the-config" title="Permalink to this headline">¶</a></h4>
<p>Configs in fuglu are stored in <code class="docutils literal"><span class="pre">/etc/fuglu/fuglu.conf</span></code> (or any .conf file in /etc/fuglu/conf.d ) in ini-style format. Your plugin gets its own section named like the plugin class.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DemoPlugin</span><span class="p">]</span>
<span class="n">maxsize</span><span class="o">=</span><span class="mi">10382</span>
</pre></div>
</div>
<p>You can then read the config in your plugin with the usual methods from a python ConfigParser object ( <a class="reference external" href="http://docs.python.org/library/configparser.html">http://docs.python.org/library/configparser.html</a> )</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">maxsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;maxsize&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Important: always load the configs in <code class="docutils literal"><span class="pre">examine</span></code> (and not in <code class="docutils literal"><span class="pre">init</span></code> !). Reading the config in init breaks loading default values and prevents on-the-fly config reload</p>
</div>
<div class="section" id="get-the-message-source">
<h4>Get the message source<a class="headerlink" href="#get-the-message-source" title="Permalink to this headline">¶</a></h4>
<p>Use <code class="docutils literal"><span class="pre">suspect.get_source()</span></code> to get the message source. The maxbytes option allows you to get only a part of the source. Reading the whole source can slow down scanning of big messages.</p>
</div>
<div class="section" id="add-headers">
<h4>Add headers<a class="headerlink" href="#add-headers" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">suspect</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">headername</span><span class="p">,</span><span class="n">headervalue</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, headers are added to the message shortly before it is re-injected into postfix.
add <code class="docutils literal"><span class="pre">immediate=True</span></code> to add the header immediately, so other plugins can see it.</p>
</div>
<div class="section" id="replace-headers">
<h4>Replace headers<a class="headerlink" href="#replace-headers" title="Permalink to this headline">¶</a></h4>
<p>Here&#8217;s an example on how to change the subject of a message.
Note: It&#8217;s generally not recommended to change existing headers, this breaks DKIM.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msgrep</span> <span class="o">=</span> <span class="n">suspect</span><span class="o">.</span><span class="n">get_message_rep</span><span class="p">()</span>
<span class="n">msgrep</span><span class="o">.</span><span class="n">replace_header</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span> <span class="s1">&#39;Scanned: &#39;</span><span class="o">+</span><span class="n">msgrep</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">])</span>
<span class="n">suspect</span><span class="o">.</span><span class="n">set_message_rep</span><span class="p">(</span><span class="n">msgrep</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-to-the-log">
<h4>Write to the log<a class="headerlink" href="#write-to-the-log" title="Permalink to this headline">¶</a></h4>
<p>Your plugin has a _logger method that returns a standard python logger object, so you can use the info / debug / error / fatal methods.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;hello world from DemoPlugin&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-debug-info">
<h4>Write debug info<a class="headerlink" href="#write-debug-info" title="Permalink to this headline">¶</a></h4>
<p>To make the plugin write special debug info when <code class="docutils literal"><span class="pre">fuglu_debug</span></code> is used, use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">suspect</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;debug info from DemoPlugin!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="make-plugin-lint-able">
<h4>Make plugin &#8216;&#8211;lint&#8217;-able<a class="headerlink" href="#make-plugin-lint-able" title="Permalink to this headline">¶</a></h4>
<p>By default, <code class="docutils literal"><span class="pre">lint()</span></code> only validates the plugin&#8217;s configuration settings from <code class="docutils literal"><span class="pre">self.requiredvars</span></code>. You can override <code class="docutils literal"><span class="pre">lint()</span></code> to do more stuff.</p>
<blockquote>
<div><ul class="simple">
<li>use simple <code class="docutils literal"><span class="pre">print</span></code> in this method, no logging stuff.</li>
<li>if you override <code class="docutils literal"><span class="pre">lint()</span></code> you should run <code class="docutils literal"><span class="pre">self.checkConfig()</span></code> to test the configuration</li>
<li><code class="docutils literal"><span class="pre">lint()</span></code> must return True or False</li>
</ul>
</div></blockquote>
<p>Example of a plugin that would check if an imap account is available:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">allok</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkConfig</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lint_imap</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">allok</span>

<span class="k">def</span> <span class="nf">lint_imap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">M</span><span class="o">=</span><span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">data</span><span class="p">)</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="o">!=</span><span class="s1">&#39;OK&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not login to imap review account: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;Could not login to imap host:</span><span class="si">%s</span><span class="s2"> - Error </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">),</span><span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="use-the-suspectfilter">
<h4>Use the &#8216;SuspectFilter&#8217;<a class="headerlink" href="#use-the-suspectfilter" title="Permalink to this headline">¶</a></h4>
<p>SuspectFilters are a common way for all plugins to perform an action based on conditions defined in a filterfile . These files are automatically re-loaded if changed.</p>
<blockquote>
<div><ul class="simple">
<li>import SuspectFilter from fuglu.shared</li>
<li>define a config variable for your plugin which holds the name of the filter file (not strictly required, you could hardcode the path)</li>
<li>create a plugin property for the filter</li>
</ul>
</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fuglu.shared</span> <span class="k">import</span> <span class="n">ScannerPlugin</span><span class="p">,</span><span class="n">SuspectFilter</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">ScannerPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ScannerPlugin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span><span class="n">section</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">requiredvars</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;myrulesfile&#39;</span><span class="p">:{</span>
                <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="s1">&#39;/etc/fuglu/mypluginrules.regex&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="s1">&#39;Filter file for my plugin&#39;</span><span class="p">,</span>
            <span class="p">},</span>

           <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">examine</span></code> create the filter if necessary</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">=</span><span class="n">SuspectFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;myrulesfile&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Run the filter in examine: <code class="docutils literal"><span class="pre">(match,arg)=self.filter.matches(suspect)</span></code>
<code class="docutils literal"><span class="pre">match</span></code> is a boolean, telling you if one of the rules matched
<cite>arg`</cite> is an additional argument which have been appended to the filter rule in the config. lets say, the filter rule reads <code class="docutils literal"><span class="pre">to_address</span> <span class="pre">example&#64;fuglu.org</span> <span class="pre">hello</span> <span class="pre">world!</span></code>, you would get match=True and arg=&#8217;Hello world!&#8217; if the message is sent to <a class="reference external" href="mailto:example&#37;&#52;&#48;fuglu&#46;org">example<span>&#64;</span>fuglu<span>&#46;</span>org</a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">suspect</span><span class="p">)</span>
<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">arg</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;we got a match with arg </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="o">%</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;We got a match without an arg&quot;&quot;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">suspect</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no rule matches&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-the-sql-extension">
<h4>Use the sql extension<a class="headerlink" href="#use-the-sql-extension" title="Permalink to this headline">¶</a></h4>
<p>TODO (DBFiles, sqlalchemy connections)</p>
</div>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-a-stacktrace">
<h4>Get a stacktrace<a class="headerlink" href="#get-a-stacktrace" title="Permalink to this headline">¶</a></h4>
<p>if something went wrong you should see a stacktrace in the fuglu log (/var/log/fuglu/fuglu.log)
with fuglu &gt;=0.6.0 you can also get the most recent exceptions with the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fuglu_control</span> <span class="n">exceptionlist</span>
</pre></div>
</div>
</div>
<div class="section" id="debug-the-plugin-while-fuglu-is-runnig">
<h4>Debug the plugin while fuglu is runnig<a class="headerlink" href="#debug-the-plugin-while-fuglu-is-runnig" title="Permalink to this headline">¶</a></h4>
<p>run <code class="docutils literal"><span class="pre">fuglu</span> <span class="pre">--console</span></code> to enter an interactive python console after fuglu startup. Your plugin is then available via the list <code class="docutils literal"><span class="pre">mc.plugins</span></code></p>
</div>
<div class="section" id="debug-a-plugin-without-running-fuglu">
<h4>Debug a plugin without running fuglu<a class="headerlink" href="#debug-a-plugin-without-running-fuglu" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">plugdummy.py</span></code> is a tool that makes plugin development and testing much easier by creating a minimal fuglu environment for the plugin to run. it doesn&#8217;t require a running fuglu or postfix. it will create a dummy suspect, call the plugin&#8217;s examine method and print the result (and debug output).</p>
<p>the generated input messag is stored as: <code class="docutils literal"><span class="pre">/tmp/fuglu_dummy_message_in.eml</span></code></p>
<p>if your plugin modified the message source, the resulting message can be found at <code class="docutils literal"><span class="pre">/tmp/fuglu_dummy_message_out.eml</span></code></p>
<p><code class="docutils literal"><span class="pre">plugdummy.py</span></code> is located in the <code class="docutils literal"><span class="pre">develop/scripts</span></code> directory.</p>
<p>simple usage:</p>
<p>assuming your plugin file (&#8216;myplugin.py&#8217;) is in <code class="docutils literal"><span class="pre">/usr/local/fuglu/plugins</span></code> you can run <code class="docutils literal"><span class="pre">plugdummy.py</span> <span class="pre">&lt;pluginname&gt;</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#./plugdummy.py myplugin.ExamplePlugin

INFO:root:Input file created as /tmp/fuglu_dummy_message_in.eml
INFO:root:Running plugin: ExamplePlugin
INFO:fuglu.plugin.ExamplePlugin:sender@fuglu.local greets recipient@fuglu.local: hello world!
INFO:root:Result: DUNNO
INFO:root:Suspect a7babc1e4cfe49c36710065966e6ed0a: from=sender@fuglu.local to=recipient@fuglu.local size=231 spam=no virus=no modified=no tags={&#39;virus&#39;: {}, &#39;spam&#39;: {}, &#39;highspam&#39;: {}}
</pre></div>
</div>
<p>Advanced usage:</p>
<p>run <code class="docutils literal"><span class="pre">plugdummy.py</span> <span class="pre">--help</span></code> to get a list of all options</p>
<p>Examples:</p>
<p>Running plugins from a different directory</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">plugdummy</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span> <span class="n">myplugin</span><span class="o">.</span><span class="n">ExamplePlugin</span>
</pre></div>
</div>
<p>Change sender / recipient
the &#8216;-s&#8217; and &#8216;-f&#8217; options change the envelope sender/recipient. -r can be specified multiple times to simulate a multi-recipient message</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./plugdummy.py -s me@example.org -r you@example.net  myplugin.ExamplePlugin
INFO:root:Input file created as /tmp/fuglu_dummy_message_in.eml
INFO:root:Running plugin: ExamplePlugin
INFO:fuglu.plugin.ExamplePlugin:me@example.org greets you@example.net: hello world!
INFO:root:Result: DUNNO
INFO:root:Suspect 423e02e1461cd1c314ac9a409176c4f4: from=me@example.org to=you@example.net size=221 spam=no virus=no modified=no tags={&#39;virus&#39;: {}, &#39;spam&#39;: {}, &#39;highspam&#39;: {}}
</pre></div>
</div>
<p>Adding headers to the input message</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./plugdummy.py -h &#39;subject:yo! whassup&#39; myplugin.ExamplePlugin
[...]
cat /tmp/fuglu_dummy_message_in.eml
Content-Type: text/plain; charset=&quot;us-ascii&quot;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
From: sender@fuglu.local
To: recipient@fuglu.local
Subject: yo! whassup
Date: Fri, 01 Jun 2012 12:58:34 -0000

hello, world!
</pre></div>
</div>
<p>Adding tags:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./plugdummy.py -t &#39;mytag:myvalue&#39; myplugin.ExamplePlugin
INFO:root:Input file created as /tmp/fuglu_dummy_message_in.eml
INFO:root:Running plugin: ExamplePlugin
INFO:fuglu.plugin.ExamplePlugin:sender@fuglu.local greets recipient@fuglu.local: hello world!
INFO:root:Result: DUNNO
INFO:root:Suspect 168268d6ff2c2748454183efcb554242: from=sender@fuglu.local to=recipient@fuglu.local size=231 spam=no virus=no modified=no tags={&#39;spam&#39;: {}, &#39;virus&#39;: {}, &#39;mytag&#39;: &#39;myvalue&#39;, &#39;highspam&#39;: {}}
</pre></div>
</div>
<p>Setting a config option:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./plugdummy.py -o &#39;greeting:go away!&#39;  myplugin.ExamplePlugin
INFO:root:Input file created as /tmp/fuglu_dummy_message_in.eml
INFO:root:Running plugin: ExamplePlugin
INFO:fuglu.plugin.ExamplePlugin:sender@fuglu.local greets recipient@fuglu.local: go away!
[...]
</pre></div>
</div>
<p>Setting the message body:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#set body</span>
<span class="o">./</span><span class="n">plugdummy</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">b</span> <span class="s1">&#39;hi there, whassup!&#39;</span> <span class="n">myplugin</span><span class="o">.</span><span class="n">ExamplePlugin</span>

<span class="c1">#read body from file</span>
<span class="o">./</span><span class="n">plugdummy</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">b</span> <span class="n">bla</span><span class="o">.</span><span class="n">txt</span> <span class="n">myplugin</span><span class="o">.</span><span class="n">ExamplePlugin</span>

<span class="c1">#read headers &amp; body from eml file</span>
<span class="o">./</span><span class="n">plugdummy</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">bla</span><span class="o">.</span><span class="n">eml</span> <span class="n">myplugin</span><span class="o">.</span><span class="n">ExamplePlugin</span>
</pre></div>
</div>
<p>Running a interactive console in the dummy enrivonment:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./plugdummy.py -c  myplugin.ExamplePlugin
INFO:root:Input file created as /tmp/fuglu_dummy_message_in.eml
INFO:root:Running plugin: ExamplePlugin
INFO:fuglu.plugin.ExamplePlugin:sender@fuglu.local greets recipient@fuglu.local: hello world!
INFO:root:Result: DUNNO
INFO:root:Suspect 3cf496cbe2a1097abc37ebda5a645cd2: from=sender@fuglu.local to=recipient@fuglu.local size=231 spam=no virus=no modified=no tags={&#39;virus&#39;: {}, &#39;spam&#39;: {}, &#39;highspam&#39;: {}}
Fuglu Interactive Console started

pre-defined locals:
{&#39;config&#39;: &lt;ConfigParser.ConfigParser instance at 0x1ac9e60&gt;, &#39;suspect&#39;: &lt;fuglu.shared.Suspect object at 0x1ac8750&gt;, &#39;result&#39;: 0, &#39;plugin&#39;: &lt;myplugin.ExamplePlugin object at 0x1ac8290&gt;}

&gt;&gt;&gt; plugin.requiredvars
{&#39;greeting&#39;: {&#39;default&#39;: &#39;hello world!&#39;, &#39;description&#39;: &#39;greeting the plugin should log to the console&#39;}}
&gt;&gt;&gt; plugin.examine(suspect)
INFO:fuglu.plugin.ExamplePlugin:sender@fuglu.local greets recipient@fuglu.local: hello world!
0
&gt;&gt;&gt; config.set(&#39;ExamplePlugin&#39;,&#39;greeting&#39;,&#39;Greetings, Earthling&#39;)
&gt;&gt;&gt; suspect.from_address=&#39;me@example.org&#39;
&gt;&gt;&gt; plugin.examine(suspect)
INFO:fuglu.plugin.ExamplePlugin:me@example.org greets recipient@fuglu.local: Greetings, Earthling
0
&gt;&gt;&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="deploying-plugins">
<h3>Deploying Plugins<a class="headerlink" href="#deploying-plugins" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>If there is no <code class="docutils literal"><span class="pre">plugindir</span></code> set in fuglu.conf yet, define a new directory for custom plugins. eg <code class="docutils literal"><span class="pre">/usr/local/fuglu/plugins</span></code>.</li>
<li>Copy your plugin file to this directory</li>
<li>Depending on the type of your plugin, add it to the plugin/prependers/appenders config option. Eg. if your scanner plugin class is <code class="docutils literal"><span class="pre">MyHeloPlugin</span></code> in the file myplugin.py you would add <code class="docutils literal"><span class="pre">myplugin.MyHeloPlugin</span></code> to the <code class="docutils literal"><span class="pre">plugins</span></code> config</li>
<li>If your plugin reads configuration entries, make sure those are present in fuglu.conf or in a custom conf-file in /etc/fuglu/conf.d</li>
<li>Run <code class="docutils literal"><span class="pre">fuglu</span> <span class="pre">--lint</span></code> to check if fuglu is happy with your new plugin</li>
<li>(Re)start fuglu</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Plugins</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#types-of-plugins">Types of plugins</a><ul>
<li><a class="reference internal" href="#scanner-plugins">Scanner Plugins</a></li>
<li><a class="reference internal" href="#prepender-plugins">Prepender Plugins</a></li>
<li><a class="reference internal" href="#appender-plugins">Appender Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-configuration">Plugin configuration</a><ul>
<li><a class="reference internal" href="#suspect-filters">Suspect Filters</a></li>
<li><a class="reference internal" href="#template-variables">Template Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugins-included-in-fuglu">Plugins included in Fuglu</a><ul>
<li><a class="reference internal" href="#spamassassin">SpamAssassin</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#clam-av">Clam AV</a><ul>
<li><a class="reference internal" href="#id1">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attachment-blocker">Attachment Blocker</a><ul>
<li><a class="reference internal" href="#id2">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#archive">Archive</a><ul>
<li><a class="reference internal" href="#id3">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vacation">Vacation</a><ul>
<li><a class="reference internal" href="#id4">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sophos">Sophos</a><ul>
<li><a class="reference internal" href="#id5">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#f-prot-av">F-Prot AV</a><ul>
<li><a class="reference internal" href="#id6">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#icap-av">ICAP AV</a><ul>
<li><a class="reference internal" href="#id7">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#drweb-av">DrWeb AV</a><ul>
<li><a class="reference internal" href="#id8">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#action-override">Action Override</a><ul>
<li><a class="reference internal" href="#id9">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scriptfilter">ScriptFilter</a><ul>
<li><a class="reference internal" href="#id10">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dkim-sign">DKIM Sign</a><ul>
<li><a class="reference internal" href="#id11">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dkim-verify">DKIM Verify</a><ul>
<li><a class="reference internal" href="#id12">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spf-check">SPF Check</a><ul>
<li><a class="reference internal" href="#id13">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domainauth">DomainAuth</a><ul>
<li><a class="reference internal" href="#id14">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-skipper">Plugin Skipper</a><ul>
<li><a class="reference internal" href="#id15">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-fraction">Plugin Fraction</a><ul>
<li><a class="reference internal" href="#id16">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugger">Debugger</a><ul>
<li><a class="reference internal" href="#id17">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-plugin-time">Statsd Sender: Plugin Time</a><ul>
<li><a class="reference internal" href="#id18">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-global-message-status">Statsd Sender: Global Message Status</a><ul>
<li><a class="reference internal" href="#id19">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-per-recipient-message-status">Statsd Sender: Per Recipient Message Status</a><ul>
<li><a class="reference internal" href="#id20">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-your-own-plugins">Writing your own plugins</a><ul>
<li><a class="reference internal" href="#common-tasks-api-faq">Common Tasks (&#8220;API&#8221; FAQ)</a><ul>
<li><a class="reference internal" href="#define-configuration-options-for-your-plugin">Define configuration options for your plugin</a></li>
<li><a class="reference internal" href="#read-the-config">Read the config</a></li>
<li><a class="reference internal" href="#get-the-message-source">Get the message source</a></li>
<li><a class="reference internal" href="#add-headers">Add headers</a></li>
<li><a class="reference internal" href="#replace-headers">Replace headers</a></li>
<li><a class="reference internal" href="#write-to-the-log">Write to the log</a></li>
<li><a class="reference internal" href="#write-debug-info">Write debug info</a></li>
<li><a class="reference internal" href="#make-plugin-lint-able">Make plugin &#8216;&#8211;lint&#8217;-able</a></li>
<li><a class="reference internal" href="#use-the-suspectfilter">Use the &#8216;SuspectFilter&#8217;</a></li>
<li><a class="reference internal" href="#use-the-sql-extension">Use the sql extension</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging">Debugging</a><ul>
<li><a class="reference internal" href="#get-a-stacktrace">Get a stacktrace</a></li>
<li><a class="reference internal" href="#debug-the-plugin-while-fuglu-is-runnig">Debug the plugin while fuglu is runnig</a></li>
<li><a class="reference internal" href="#debug-a-plugin-without-running-fuglu">Debug a plugin without running fuglu</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deploying-plugins">Deploying Plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="operation-index.html"
                          title="Previous page">&larr; Operation</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="help-index.html"
                          title="Next page">&rarr; Support</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/plugins-index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="help-index.html" title="Support"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="operation-index.html" title="Operation"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">fuglu  documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, gryphius.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>
